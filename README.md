![成績](https://img.shields.io/badge/成績-*-red) ![デプロイ](https://img.shields.io/github/deployments/lvx-la/res_drawingWebApp/resdrawingwebapp2) <br>
# res_drawingWebApp

# 実機はこんな感じです
![サイネージ概要](https://user-images.githubusercontent.com/44363325/104407045-19c0df00-55a4-11eb-9633-89894d6f6c11.jpg) <br>

## 機能のフィーチャー <br>
- なぞって絵を描ける
- その絵は2地点間で共有される
- 絵の背景は反対側のサイネージ からの景色をリアルタイムに映し出す

## 研究の目的 <br>
短い会話を空間からのアプローチで増やす <br>

## 研究の目的の背景 <br>
- コロナある
- サテライトオフィスとか時差出勤で分散される傾向
- でもコミュニケーションの面で不安を抱えてる声がある
- 実際は対面より制限のあるリモートのコミュニケーションの方が伝達度が高い（伝達感は低いけど）
- じゃあ空間の提供するコミュニケーションってデカかったんじゃね？
- 空間の提供するリモートには無いコミュニケーションってなんだ
- ふとしたきっかけでクソ会話（短い会話）が始まることか？
- 矢野らは「組織のほぼ全員において挨拶・連絡などの短い会話の多い日には組織活性度が高いと言える」と
- これじゃね？

## まとめのまとめ <br>
サテライトオフィス・時差出勤の分散によって以前に比べて会話相手が相対的に減ってる <br>
じゃあ会話も減ってるはずだ <br>
小会話減ったら組織活性度低くなる ->　平均ストレス値が上がる -> 受注達成率と相関がある(職種によるけど) -> 生産性低下する。<br>
じゃあ分散された職場でも、分散を埋めて短い会話を増やすなんか作ろう！コレ<br>

## 検証結果 <br>
大学において実験やったら、これのおかげで　合計 296人中23人 に会話を生むことができた、これは対通過人数の7.8%　対認知人数の25.8%です。<br>
<br>

会話のパターンは
- 片側で行われた落書きが　時間差で同じ箇所で見られて会話が発生する　時間的に分断されたシーン
- 片側で行われた落書きが　時間差で別の箇所で見られて会話が発生する 時間的にも物理的にも分断されたシーン
- 両側でリアルタイムに同時落書きをする　物理的に分断されたシーン
この3つと<br>
- 片側で複数人が同時に落書きをしたり見ることによって会話が発生する分散のないシーン
の計4つ。<br>

### このことから　分散されていてもそれぞれの場所で短い会話を創出できた　と言える <br>

## Q&A <br>
実験で出た値はサイネージない時と比べてないから比較になってなくね？ -> サイネージシステムとその内容に関する発言だけを収集したから　多分大丈夫。<br>
特異なものが存在するだけで会話なんていくらでも生まれるんじゃね？ -> 2地点落書きサイネージが飽きられても、ほぼ無限に描ける落書きの内容が無限に会話の種になると予想します。<br>
あとなんか質問あったらIssue投げてな <br>

## 備考 <br>
[olahol/melody](https://github.com/olahol/melody) の Example: gophers を改造して作りました、あざす。<br>
[WebRTC参考リンク](https://html5experts.jp/mganeko/19728/) これのおかげで　ブランチ pcusbcum では WebRTCを使ってPCのUSBカメラで同様のことができます(クソだけど)。<br>

# 試したい人向け <br>
適当にCloneしてgo run main.goすればいいかな？go getしないとエラるかもしれないんでgo.mod適当に読んでうまいこと必要なモジュールインスコしてください。<br>
Webカメラのipは[js/canvas.js](https://github.com/lvx-la/res_drawingWebApp/blob/master/js/canvas.js) の wichvideo() {} のswitch文で指定されているので、そこらへんのアドレスをいい感じにいじりましよう。<br>
Ginを起動する際にポートの指定が必要なのですが、[main.go](https://github.com/lvx-la/res_drawingWebApp/blob/master/main.go)のrouter.Run()をいい感じにいじりましょう、ちなみにHerokuでやるなら、ポート番号はHerokuのシェル上かなんかの"PORT"という環境変数にしまわれているのでos.Getenv("PORT")でゲッツしてRunメソッドの引数に突っ込んでやりましょう。ローカルで試すなら適当に5000番とか指定してあげましょう。<br>

# コード弄りたい人向け<br>
そんな物好きな変態はいないと思いますが一応再現しやすいようにこの章で情報を与えてやります。<br>
まずそもそもmelodyとginのサンプルコードを脳死で流用した行が大半なので汚コードof汚コードです、気をつけてください。<br>
使うブランチはopr(本番環境)とmaster(テスト環境)だけで十分です、あとPCでお絵かきする版のpcusbcamブランチくらいです。他は開発用ブランチを切ってないだけで残り続けているゾンビブランチです<br>
## main.go <br>
機能と実装は主に<br>
- データベース関係の機能<br>
- 落書き消去インターバルのタイマー<br>
- websocketサーバー<br>
となってます。<br>
## js/canvas.js <br>
機能と実装は主に<br>
- websocket接続<br>
- canvasのお絵かき機能<br>
- (あんまり意味をなさなかった)ポイント機能<br>
- HTMLの動的書き換え
くらいです。<br>

Websocketの通信内容はJSONなどと言った高貴なモノではなくて半角スペースで区切った文字列ですw　melodyのサンプルコードを流用しただけなので文句は俺に言わないでください。<br>

説明するのはめんどくさいのでエンジニア兄貴は頑張ってコードを読んでください。<br>
論文に使いたいよって人は、アイデアだけ~~パクって~~引用してPHPとか使って自力で作り上げたほうが楽かもね<br>
卒論中の実装のところでも変な模式図よりUML図書けよ！！って自分でも思いますが気がついたらPhotoshop起動して作っていたのでスマン　今更作り直す気力ねえわ。<br>
<br>
# 開発日記 <br>
# 8月13日 <br>
リポジトリをやっと作った。Goでいけそう　頑張る <br>
キーワード Websocket melody <br>
djangoは捨てた <br>

# 8月23日 <br>
Websocketメッセージのバッファを設定しないといけないことに気づくのに1週間かかった
大方できた あとはフロントエンド綺麗にする <br>
とりまHerokuにプッシュする<br>
わんちゃんモバイル端末のカメラ使えないぎわくある ssl問題解決してからじゃないと解決できないけど<br>

# 9月4日 <br>
SSL化されてなくてもフル信頼する設定のChrome & PCで確認は取れてるけど<br>
ちゃんとSSL化しないとモバイルデバイスで確認が取れない。<br>
<br>
### SSL化のやり方<br>
- Herokuで月$7払う<br>
一見 簡単そう、手元ですぐ試せる。けど金は払いたくない<br>
- 大学のサーバーx & DNS & let's encrypt<br>
金払わなくて済みそうだけど大学行かないといけない & めんどくさそう　はっきり言って交通費の方が高いけどどうせ週1行くならこれでいい気が<br>

結果　本番環境わからないと手も足も出ない からとりま放置<br>
まあできるっしょ<br>

# 9月5日<br>
Herokuの学割が通ったのでHobby DynoでSSLが利用できるらしい<br>
しかし完全にSSL化するには独自のドメインを取らないといけないらしく、別に25円とかで安いからいいのだが、個人情報を公開するハメになるようだ。<br>
大学名義でドメインを取れればいいのだけど、住所と電話番号と組織名貸してもらえないかな<br>

# 10月15日 <br>
ドメインをゲッツして設定をしないと常時SSLにならずに、WebSocketの通信が行えないよー！　だと思っていたのだが、WebSocketのURLをws:// から wss://　にすることによってSSLを利用したWebSocketを利用できるらしい。<br>
そんなことは知らなかったので、sをコードにひとつ追加しただけで1ヶ月間の悩みは解決された、なぜ早く気づかなかったのだろう。<br>
晴れて完成！と言って差し支えないレベルだが、モバイルへの対応など、実験を行うに際しての実機にすり合わせたチューニングが必要になってきそうだ。<br>
Websocketメッセージのバッファを設定しないといけないことに気づくのに1週間かかった <br>

# 11月23日 <br>
Webカメラを使うと、p2pを実現しようと大変だった1週間はなんだったのかと思うくらいあっけなく <br>
カメラの設定を行うことができた。<br>
公式のマニュアルがクソなのか、ストリームされているURLを見つけるのが大変だったけど、それさえできれば本当にimgタグで終わるw <br>
ほんと実質1週間で開発終わったんじゃないのってくらいの呆気なさ　ありがとう<br>
あとは検証だ。検証して、卒論書く！もう最後の方のコミットだぞ。
